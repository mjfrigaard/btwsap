---
title: "Tables"
format: 
  html:
    toc: true
    toc-depth: 4
    toc-title: 'Contents'
    toc-expand: true
vignette: >
  %\VignetteIndexEntry{Tables}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---


```{r}
#| label: setup
#| include: false
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "ragg_png",
  dpi = 320, 
  out.width = "85%",
  fig.width = 6,
  fig.asp = 0.618,
  fig.retina = 2,
  fig.align = "center"
)
```

```{r}
#| eval: true
library(sap)
```


This document covers the `gt` table styling the Shiny application.[^table-style-ref]

```{r}
library(gt)
library(dplyr)
```

## Counts

Create data with inputs similar to the UI:

```{r}
# inputs
vals <- list(
  chr_var = "mpaa_rating",
  start_year = 1980L,
  end_year = 1990L)
# subset
count_data <- subset(
  movies,
  thtr_rel_year >= vals$start_year &
  thtr_rel_year <= vals$end_year
)
# convert selected variable to snake_case
group_var <- name_case(as.character(vals$chr_var), case = "lower")

# count per group using tidy evaluation
tbl_data <- count_data |>
  dplyr::group_by(.data[[group_var]]) |>
  dplyr::summarise(n = dplyr::n(), .groups = "drop") |>
  dplyr::arrange(dplyr::desc(n))
      
# normalize column names in the data
names(tbl_data) <- name_case(names(tbl_data))
tbl_data
```

Create table:

```{r}
# gt table with dark theme styling
gt::gt(tbl_data) |> 
gt::tab_options(
  table.width = gt::pct(100),
  table.font.color = "#ffffff",
  table.align = "left",
  heading.align = "left",
  table.background.color = "#121212",
  column_labels.background.color = "#1e1e1e",
  table.font.size = gt::px(20),
  table.border.top.style = "hidden",
  table.border.bottom.style = "hidden"
) |> 
gt::opt_row_striping()
```

## Distributions 

```{r}
vals <- list(
  chr_var = "Critics Rating",
  num_var = "Audience Score",
  alpha = 0.8,
  size = 3)
# capture variables from reactive input
chr_var <- as.character(vals$chr_var)
num_var <- as.character(vals$num_var)
        
# transform movie data names
mv_nms <- names(sap::movies) |> name_case()
movie_data <- setNames(object = sap::movies, nm = mv_nms)

# generate summary data
tbl_data <- dist_var_summary(
                  data = movie_data, 
                  grp_var = chr_var, 
                  num_var = num_var)
tbl_data
```

```{r}
# create gt table
tbl_data |>
gt::gt() |>
gt::tab_options(
  table.width = gt::pct(100),
  table.background.color = "#121212",
  table.font.color = "#ffffff",
  table.border.top.style = "none",
  table.border.bottom.style = "none",
  table.font.size = gt::px(20)
  ) |>
  gt::opt_row_striping()
```


## Awards

```{r}
#| eval: true
vals <- list(
  award = "picture/director",
  year = 1987)
# create awards data 
award <- as.character(vals$award)
year <- as.numeric(vals$year)
if (award == "picture/director") {
  awards <- get_award_recipients(sap::movies, 
                                 award = "picture/director", 
                                 year = year)
} else {
  awards <- get_award_recipients(sap::movies, 
                                 award = "actor/actress", 
                                 year = year)
}
# normalize columns
tbl_names <- name_case(names(awards))
tbl_data <- stats::setNames(object = awards, nm = tbl_names)
tbl_data
```

```{r}
#| eval: true
# gt table
gt::gt(tbl_data) |>
gt::tab_options(
  table.width = gt::pct(100),
  table.background.color = "#121212",
  table.font.color = "#ffffff",
  table.border.top.style = "none",
  table.border.bottom.style = "none",
  table.font.size = gt::px(20)
) |>
  gt::opt_row_striping()
```


[^table-style-ref]: Read more [here](https://gt.rstudio.com/).
